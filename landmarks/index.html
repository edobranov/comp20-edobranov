<!DOCTYPE html>

<!--

	Filename:	index.html
	Purpose:	
	Author:		EVGENI C. DOBRANOV
	Date:		3/12/2016

-->

<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<title>Landmarks</title>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<script src="https://maps.googleapis.com/maps/api/js"></script>
	</head>

	<body onload="getLocation()">
	
		<div id="map"></div>
		
		<script>
					
			// ***************************************************************
			// * (1) First we focus on getting user's longitude and latitude *
			// ***************************************************************
			
			myLat = 0;
			myLon = 0;
			function getLocation()	// This function is called as soon as the body loads
			{
				if (navigator.geolocation)	// If navigator is enabled in browser
				{
					navigator.geolocation.getCurrentPosition(function(position)
					{
						myLat = position.coords.latitude;	// Store latitude
						myLon = position.coords.longitude;	// Store longitude
						console.log(myLat);
						console.log(myLon);
						
						// *************************************************
						// * (2) We can now set up Google Maps in the HTML *
						// *************************************************
						
						var myMap = new google.maps.Map(document.getElementById('map'), {
							zoom: 13
						});
						
						var myCoords = new google.maps.LatLng(myLat, myLon);
						myMap.setCenter(myCoords);
						
						var myMarker = new google.maps.Marker({
						position: myCoords,
						title: "BENJAMIN_SWEET"
						});
						
						myMarker.setMap(myMap);
					});
					
				}
			}
			
			// ****************************************************************
			// * (3) Now we focus on send the request to the herokuapp server *
			// ****************************************************************
			
			// Instantiate a new XMLHttpRequest object
			var request = new XMLHttpRequest();
			
			// Store the url that will be accessed via POST and the parameters
			var url = "https://defense-in-derpth.herokuapp.com/sendLocation";
			var param = "login=BENJAMIN_SWEET&lat=" + myLat + "&lng=" + myLon;
			
			// Open the request via POST, access the URL, and do so asynchronously
			request.open("POST", url, true);
			
			// Request header for further specificity
			request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			
			// Whenever the request state changes, call this function
			request.onreadystatechange = function()
			{
				// If the request is returned and done so succesfully...
				if (request.readyState == 4 && request.status == 200)
				{
					data = JSON.parse(request.responseText); // Parse the JSON data
					console.log(data);
				}
				
			};
			
			// Now that everything's set up, we send the data along
			request.send(param);
			
		</script>
		
	</body>
	
</html>	